{% extends "base.html" %}

{% block title %}PDV - Bike Shop ERP{% endblock %}
{% block page_title %}Ponto de Venda{% endblock %}

{% block content %}
<div class="pdv-container" x-data="{ warehouseId: '' }">
    <!-- CabeÃ§alho PDV -->
    <div class="pdv-header">
        <div class="form-group">
            <label>DepÃ³sito</label>
            <select name="warehouse_id" x-model="warehouseId" required>
                <option value="">Selecione o depÃ³sito...</option>
                {% for wh in warehouses %}
                <option value="{{ wh.id }}">{{ wh.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Cliente</label>
            <select name="client_id" id="client-select" required>
                <option value="">Selecione o cliente...</option>
                {% for client in clients %}
                <option value="{{ client.id }}">{{ client.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="pdv-grid">
        <!-- Busca de Produtos -->
        <div class="pdv-search">
            <div class="card">
                <div class="card-header">
                    <h3>Buscar Produto</h3>
                </div>
                <div class="card-body">
                    <input type="text" name="q" placeholder="Digite o nome ou SKU..."
                        hx-get="{% url 'sales:product_search' %}" hx-trigger="keyup changed delay:300ms"
                        hx-target="#search-results" hx-include="[name='warehouse_id']" :disabled="!warehouseId">

                    <div id="search-results" class="search-results"></div>
                </div>
            </div>
        </div>

        <!-- Carrinho -->
        <div class="pdv-cart">
            <div class="card">
                <div class="card-header">
                    <h3>ðŸ›’ Carrinho</h3>
                    <span class="cart-total" id="cart-total-header">
                        R$ {{ cart_total|floatformat:2 }}
                    </span>
                </div>

                <div id="cart-items" class="card-body">
                    {% include "sales/partials/cart_items.html" %}
                </div>

                <div class="card-footer">
                    <div class="cart-summary">
                        <span class="total-label">Total:</span>
                        <span class="total-value" id="cart-total">
                            R$ {{ cart_total|floatformat:2 }}
                        </span>
                    </div>

                    <form hx-post="{% url 'sales:sale_complete' %}" hx-target="#cart-items"
                        hx-include="[name='warehouse_id'], [name='client_id']">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary btn-lg btn-block"
                            :disabled="!warehouseId || {{ cart|length }} == 0">
                            âœ… Finalizar Venda
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}